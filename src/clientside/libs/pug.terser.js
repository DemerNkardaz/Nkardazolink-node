e=require("fs"),r=require("path"),n=require("pug-lexer"),t=require("pug-strip-comments"),i=require("pug-parser"),o=require("pug-load"),l=require("pug-filters"),u=require("pug-linker"),p=require("pug-code-gen"),c=require("pug-runtime"),s=require("pug-runtime/wrap");function a(e,r,n,t){return n.reduce((function(e,n){return n[t]?n[t](e,r):e}),e)}function f(e,r){var n=e.filter((function(e){return e[r]}));if(n.length>1)throw new Error("Two or more plugins all implement "+r+" method.");return n.length?n[0][r].bind(n[0]):null}function m(e,c){var s={};s[c.filename]=e;var m=[],d=c.plugins||[],g=o.string(e,{filename:c.filename,basedir:c.basedir,lex:function(e,r){var t={};Object.keys(r).forEach((function(e){t[e]=r[e]})),t.plugins=d.filter((function(e){return!!e.lex})).map((function(e){return e.lex}));var i=a(e,{filename:r.filename},d,"preLex");return a(n(i,t),r,d,"postLex")},parse:function(e,n){e=e.map((function(e){return"path"===e.type&&""===r.extname(e.val)?{type:"path",loc:e.loc,val:e.val+".pug"}:e})),e=a(e=t(e,n),n,d,"preParse");var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.plugins=d.filter((function(e){return!!e.parse})).map((function(e){return e.parse})),a(a(i(e,o),n,d,"postParse"),n,d,"preLoad")},resolve:function(e,r,n){var t=f(d,"resolve");return t?t(e,r,c):o.resolve(e,r,n)},read:function(e,r){var n;m.push(e);var t=f(d,"read");return n=t?t(e,c):o.read(e,r),s[e]=Buffer.isBuffer(n)?n.toString("utf8"):n,n}});g=a(g,c,d,"postLoad"),g=a(g,c,d,"preFilters");var b={};Object.keys(exports.filters).forEach((function(e){b[e]=exports.filters[e]})),c.filters&&Object.keys(c.filters).forEach((function(e){b[e]=c.filters[e]})),g=a(g=l.handleFilters(g,b,c.filterOptions,c.filterAliases),c,d,"postFilters"),g=a(g,c,d,"preLink"),g=a(g=u(g),c,d,"postLink"),g=a(g,c,d,"preCodeGen");var x=(f(d,"generateCode")||p)(g,{pretty:c.pretty,compileDebug:c.compileDebug,doctype:c.doctype,inlineRuntimeFunctions:c.inlineRuntimeFunctions,globals:c.globals,self:c.self,includeSources:!!c.includeSources&&s,templateName:c.templateName});return x=a(x,c,d,"postCodeGen"),c.debug&&console.error("\nCompiled Function:\n\n[90m%s[0m",x.replace(/^/gm,"  ")),{body:x,dependencies:m}}function d(r,n){var t=r.filename;if(r.cache&&exports.cache[t])return exports.cache[t];void 0===n&&(n=e.readFileSync(r.filename,"utf8"));var i=exports.compile(n,r);return r.cache&&(exports.cache[t]=i),i}exports.name="Pug",exports.runtime=c,exports.cache={},exports.filters={},exports.compile=function(e,r){r=r||{};var n=m(e=String(e),{compileDebug:!1!==r.compileDebug,filename:r.filename,basedir:r.basedir,pretty:r.pretty,doctype:r.doctype,inlineRuntimeFunctions:r.inlineRuntimeFunctions,globals:r.globals,self:r.self,includeSources:!0===r.compileDebug,debug:r.debug,templateName:"template",filters:r.filters,filterOptions:r.filterOptions,filterAliases:r.filterAliases,plugins:r.plugins}),t=r.inlineRuntimeFunctions?new Function("",n.body+";return template;")():s(n.body);return t.dependencies=n.dependencies,t},exports.compileClientWithDependenciesTracked=function(e,r){r=r||{};var n=m(e=String(e),{compileDebug:r.compileDebug,filename:r.filename,basedir:r.basedir,pretty:r.pretty,doctype:r.doctype,inlineRuntimeFunctions:!1!==r.inlineRuntimeFunctions,globals:r.globals,self:r.self,includeSources:r.compileDebug,debug:r.debug,templateName:r.name||"template",filters:r.filters,filterOptions:r.filterOptions,filterAliases:r.filterAliases,plugins:r.plugins}),t=n.body;return r.module&&(!1===r.inlineRuntimeFunctions&&(t='var pug = require("pug-runtime");'+t),t+=" module.exports = "+(r.name||"template")+";"),{body:t,dependencies:n.dependencies}},exports.compileClient=function(e,r){return exports.compileClientWithDependenciesTracked(e,r).body},exports.compileFile=function(e,r){return(r=r||{}).filename=e,d(r)},exports.render=function(e,r,n){if("function"==typeof r&&(n=r,r=void 0),"function"==typeof n){var t;try{t=exports.render(e,r)}catch(e){return n(e)}return n(null,t)}if((r=r||{}).cache&&!r.filename)throw new Error('the "filename" option is required for caching');return d(r,e)(r)},exports.renderFile=function(e,r,n){if("function"==typeof r&&(n=r,r=void 0),"function"==typeof n){var t;try{t=exports.renderFile(e,r)}catch(e){return n(e)}return n(null,t)}return(r=r||{}).filename=e,d(r)(r)},exports.compileFileClient=function(r,n){var t=r+":client";if((n=n||{}).filename=r,n.cache&&exports.cache[t])return exports.cache[t];var i=e.readFileSync(n.filename,"utf8"),o=exports.compileClient(i,n);return n.cache&&(exports.cache[t]=o),o},exports.__express=function(e,r,n){null==r.compileDebug&&"production"===process.env.NODE_ENV&&(r.compileDebug=!1),exports.renderFile(e,r,n)}